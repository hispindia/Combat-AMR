(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{202:function(e,t,a){},263:function(e,t,a){"use strict";a.r(t);var n=a(1),l=a.n(n),s=(a(202),a(6),a(203),a(204)),o=a.n(s),c=a(259),r=a(260),i=a(262),d=a(261);class m extends n.Component{constructor(e){super(e),this.getEvents=(e,t,a)=>{var n=[],l={};try{var s=this.state.dECOC,c="../../../api/events.json?paging=false&orgUnit=".concat(e,"&ouMode=DESCENDANTS");return t&&(c+="&startDate=".concat(t)),a&&(c+="&endDate=".concat(a)),o.a.get(c).then(e=>{if(e.data.events.forEach(e=>{var t={},a={},l={};e.eventDate&&(t.eventDate=e.eventDate.split("T")[0],t.orgUnit=e.orgUnit,t.program=e.program,e.dataValues.forEach(e=>a[e.dataElement]=e.value),a.SaQe2REkGVw&&(l.deCode=a.SaQe2REkGVw),a.mp5MeJ2dFQz&&a.B7XuDaXPv10&&(l.COC="".concat(a.mp5MeJ2dFQz,", ").concat(a.B7XuDaXPv10)),t.dataValues=l,n.push(t))}),n.length)return n.forEach(e=>{let t="".concat(e.eventDate.split("-")[0],"-").concat(e.eventDate.split("-")[1]),a=e.orgUnit,n=e.dataValues.deCode,o=e.dataValues.COC;s[n]&&s[o]&&t&&a&&(l["".concat(a,":").concat(t,":").concat(s[n],"-").concat(s[o])]||(l["".concat(a,":").concat(t,":").concat(s[n],"-").concat(s[o])]=0),l["".concat(a,":").concat(t,":").concat(s[n],"-").concat(s[o])]+=1)}),l})}catch(r){console.log("Error in getEvents")}},this.getAntiEvents=(e,t,a)=>{var n=[],l={};try{var s=this.state.deCOC_anti,c=this.state.deAnti,r="../../../api/events.json?paging=false&orgUnit=".concat(e,"&ouMode=DESCENDANTS");return t&&(r+="&startDate=".concat(t)),a&&(r+="&endDate=".concat(a)),o.a.get(r).then(e=>{if(e.data.events.forEach(e=>{var t={},a={},l={};if(e.eventDate){t.eventDate=e.eventDate.split("T")[0],t.orgUnit=e.orgUnit,t.program=e.program,e.dataValues.forEach(e=>a[e.dataElement]=e.value),a.SaQe2REkGVw&&(l.deCode=a.SaQe2REkGVw+"_AW");for(const e in a){let t=e in c;if(console.log("ANTIBIOTCSSS ANTIVALUES : ",e,"----",c),t){var s=c[e];if(s=(s=s.split("_")[0])+"-"+a[e],a.mp5MeJ2dFQz&&a.B7XuDaXPv10){l["COC_"+s]="".concat(s,", ").concat(a.mp5MeJ2dFQz,", ").concat(a.B7XuDaXPv10)+"_"+a.SaQe2REkGVw+"_AW"}}}t.dataValues=l,n.push(t)}}),n.length)return n.forEach(e=>{let t="".concat(e.eventDate.split("-")[0],"-").concat(e.eventDate.split("-")[1]),a=e.orgUnit,n=e.dataValues.deCode;for(var o in e.dataValues){let c="";n!=e.dataValues[o]&&(c=e.dataValues[o]),console.log("COC KEYS",n," : ",c),s[n]&&s[c]&&t&&a&&(l["".concat(a,":").concat(t,":").concat(s[n],"-").concat(s[c])]||(l["".concat(a,":").concat(t,":").concat(s[n],"-").concat(s[c])]=0),l["".concat(a,":").concat(t,":").concat(s[n],"-").concat(s[c])]+=1)}}),l})}catch(i){console.log("Error in getEvents")}},this.state={startDate:"",endDate:"",dECOC:{},deAnti:{},programCount:{},dataJson:{},loading:!0,pushed:!1,show:!1,buttonVisible:!1,imported:0,updated:0,deleted:0,ignored:0,conflicts:0,deCOC_anti:{}},this.getdECOC=this.getdECOC.bind(this),this.postDataValues=this.postDataValues.bind(this)}async getAntibio(){var e={};try{o.a.get("../../../api/sqlViews/Td7tyBlEqrT/data.json?paging=false").then(t=>{t.data.listGrid.rows.forEach(t=>{t[2]&&(e[t[1]]=t[2])}),this.setState({deAnti:e})})}catch(t){console.log("Error"),this.setState({loading:!1})}}async getdECOC(){var e={},t={};let a=o.a.get("../../../api/29/sqlViews/nExolJ6VsR5/data.json?paging=false"),n=o.a.get("../../../api/29/sqlViews/X0cT1wQvk9M/data.json?paging=false"),l=o.a.get("../../../api/29/sqlViews/nWUC12EYfQj/data.json?paging=false"),s=o.a.get("../../../api/29/sqlViews/rwE9Q42RHfg/data.json?paging=false");try{o.a.all([a,n,l,s]).then(o.a.spread((...a)=>{a[0],a[1],a[2],a[3];a.forEach(a=>{a.data.listGrid.rows.forEach(a=>{if("- AW"==a[1].match(/- AW/g)){let e=a[7]+"_"+a[0];a[0]in t||(t[a[0]]=a[2]),e in t||(t[e]=a[6])}else a[0]&&(e[a[0]]=a[2]),a[7]&&(e[a[7]]=a[6])})}),this.setState({dECOC:e}),this.setState({loading:!1}),this.setState({deCOC_anti:t})})).catch(e=>{console.log("Errors",e)})}catch(c){console.log("Error",c),this.setState({loading:!1})}}async postDataValues(e,t="",a=""){this.setState({loading:!0});try{var n=await this.getEvents(e,t,a),l=[];for(let e in n){var s={},c=e.split(":");s.orgUnit=c[0],s.period=c[1].split("-").join(""),s.dataElement=c[2].split("-")[0],s.categoryOptionCombo=c[2].split("-")[1],s.value=n[e],l.push(s)}console.log("DATA Sample Wise : ",n);var r=await this.getAntiEvents(e,t,a);for(let e in r){var i={},d=e.split(":");i.orgUnit=d[0],i.period=d[1].split("-").join(""),i.dataElement=d[2].split("-")[0],i.categoryOptionCombo=d[2].split("-")[1],i.value=r[e],l.push(i)}console.log("Data Antibiotics wise : ",r);var m={};m.dataValues=l;var h=JSON.stringify(m);console.log(m);const g={"Content-Type":"application/json",dataType:"json"};o.a.post("../../../api/dataValueSets",h,{headers:g}).then(e=>{console.log(e);var t=e.data.importCount.imported,a=e.data.importCount.updated,n=e.data.importCount.ignored,l=e.data.importCount.deleted;this.setState({imported:t,deleted:l,updated:a,ignored:n,loading:!1})}).catch((function(e){console.log(e)}))}catch(g){console.log(g)}this.setState({loading:!1}),this.setState({pushed:!0}),this.setState({show:!1})}importData(){this.setState({show:!0}),this.setState({pushed:!1}),this.setState({buttonVisible:!0})}componentDidMount(){this.getdECOC(),this.getAntibio()}handleChange(e,t){this.setState({[t]:e.target.value})}render(){const{startDate:e,endDate:t}=this.state,{imported:a,updated:n,deleted:s,ignored:o}=this.state;return this.state.loading?l.a.createElement("div",{className:"pt-4 m-5 pb-5 mh-100 shadow-lg p-3 mb-4 bg-white rounded"},l.a.createElement("h2",{className:"ml-5"},"Tracker Aggregation "),l.a.createElement(c.a,{animation:"border"}),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("span",{class:"ml-8"},"Loading Data ...")):this.state.pushed?l.a.createElement("div",{className:"pt-4 m-5 pb-5 mh-100 shadow-lg p-3 mb-4 bg-white rounded"},l.a.createElement("h2",{className:"ml-5"},"Tracker Aggregation "),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement(r.a,{striped:!0,bordered:!0,hover:!0},l.a.createElement("thead",null),l.a.createElement("tbody",null,l.a.createElement("tr",null,l.a.createElement("td",null,"Imported"),l.a.createElement("td",null,"Updated"),l.a.createElement("td",null,"Deleted"),l.a.createElement("td",null,"Ignored"),l.a.createElement("td",null,"Conflicts")),l.a.createElement("tr",null,l.a.createElement("td",null,a),l.a.createElement("td",null,n),l.a.createElement("td",null,s),l.a.createElement("td",null,o),l.a.createElement("td",null,this.state.conflicts)))),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement(i.a,{variant:"success"},"Data Pushed Successfully!!"),l.a.createElement("br",null),l.a.createElement(d.a,{onClick:()=>this.importData()},"Back")):this.state.show?l.a.createElement("div",{className:"pt-4 m-5 pb-5 mh-100 shadow-lg p-3 mb-4 bg-white rounded"},l.a.createElement("h2",{className:"ml-5"},"Tracker Aggregation "),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-sm-2 m-1 ml-5"}," Org Unit:"),l.a.createElement("div",{className:"col-sm-4 m-1"}," ",l.a.createElement("input",{className:"form-control",value:this.props.data.displayName}))),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-sm-2 m-1 ml-5 "},"Start Date:"),l.a.createElement("div",{className:"col-sm-4 m-1"},l.a.createElement("input",{type:"date",value:e,onChange:e=>this.handleChange(e,"startDate"),className:"form-control"}))),l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-sm-2 m-1 ml-5 "},"End Date"),l.a.createElement("div",{className:"col-sm-4 m-1"},l.a.createElement("input",{type:"date",value:t,onChange:e=>this.handleChange(e,"endDate"),className:"form-control"}))),l.a.createElement("button",{className:"btn btn-primary ml-5",onClick:()=>this.postDataValues(this.props.data.id,e,t)},"Submit")):l.a.createElement("div",{className:"pt-4 m-5 pb-5 mh-100 shadow-lg p-3 mb-4 bg-white rounded"},l.a.createElement("h2",{className:"ml-5"},"Tracker Aggregation "),l.a.createElement("br",null),l.a.createElement("br",null),l.a.createElement("div",{className:"row ml-5"},l.a.createElement(d.a,{onClick:()=>this.importData()},"Import Data")))}}var h=m,g=a(224);a(7);const p=e=>console.error(e);class u extends n.Component{constructor(){super(),this.state={orgUnit:""},this.onSelect=this.onSelect.bind(this)}onSelect(e){this.setState({orgUnit:e})}render(){return l.a.createElement(l.a.Fragment,null,l.a.createElement("div",{className:"row"},l.a.createElement("div",{className:"col-lg-auto col-md-auto col-sm-auto col-xs-auto shadow-lg bg-white rounded"},l.a.createElement(g.OrgUnitTree,{onSelect:this.onSelect,onError:p})),l.a.createElement("div",{className:"col-lg-7 col-md-7 col-sm-7 col-xs-7"},l.a.createElement(h,{data:this.state.orgUnit}))))}}var E=u;t.default=()=>l.a.createElement(l.a.Fragment,null,l.a.createElement(E,null))}}]);
//# sourceMappingURL=app.4d3992b3.chunk.js.map